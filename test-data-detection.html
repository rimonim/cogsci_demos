<!DOCTYPE html>
<html>
<head>
    <title>Test Data Detection</title>
</head>
<body>
    <h1>Test Data Detection Issue</h1>
    <p>This page will simulate the data detection issue and test the fix.</p>
    
    <button onclick="addTestData()">Add Test Data to Local Storage</button>
    <button onclick="clearTestData()">Clear Test Data</button>
    <button onclick="checkData()">Check Data Detection</button>
    
    <div id="results"></div>
    
    <script>
        function addTestData() {
            const testData = [{
                student_name: "Test Student",
                student_id: "12345",
                trial_number: 1,
                stimulus_type: "congruent",
                stimulus_display: "→→→→→",
                correct_response: "ArrowRight",
                participant_response: "ArrowRight",
                reaction_time: 500,
                is_correct: true,
                session_start_time: new Date().toISOString(),
                timestamp: new Date().toISOString(),
                task_type: "flanker",
                share_data: false
            }];
            
            localStorage.setItem('flankerResults', JSON.stringify(testData));
            document.getElementById('results').innerHTML = '<p style="color: green;">Test data added to localStorage</p>';
        }
        
        function clearTestData() {
            localStorage.removeItem('flankerResults');
            localStorage.removeItem('stroopResults');
            document.getElementById('results').innerHTML = '<p style="color: red;">Test data cleared</p>';
        }
        
        async function checkData() {
            // Simulate the detectExistingTaskData function
            try {
                // Check local storage
                const flankerData = JSON.parse(localStorage.getItem('flankerResults') || '[]');
                const stroopData = JSON.parse(localStorage.getItem('stroopResults') || '[]');
                
                const tasks = [];
                if (flankerData.length > 0) tasks.push('flanker');
                if (stroopData.length > 0) tasks.push('stroop');
                
                const result = {
                    hasData: tasks.length > 0,
                    tasks,
                    count: flankerData.length + stroopData.length
                };
                
                document.getElementById('results').innerHTML = `
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 5px;">
                        <h3>Data Detection Result:</h3>
                        <p><strong>Has Data:</strong> ${result.hasData}</p>
                        <p><strong>Tasks:</strong> ${result.tasks.join(', ')}</p>
                        <p><strong>Total Count:</strong> ${result.count}</p>
                        <hr>
                        <p><strong>Flanker Results:</strong> ${flankerData.length} items</p>
                        <p><strong>Stroop Results:</strong> ${stroopData.length} items</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('results').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
