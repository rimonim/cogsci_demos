import{j as e}from"./index-1d5000f4.js";import{r as o,u as ne}from"./react-vendor-36975316.js";import{C as T,c as L,b as z,a as k,B as _}from"./button-86fc270d.js";import{L as E,I as K,P as le}from"./label-22ca0528.js";import{f as ie,E as ce,a as G,T as W,g as Z,e as oe,h as de,D as me,U as xe}from"./ui-vendor-5b437901.js";function ue({onComplete:t}){const[i,n]=o.useState(""),[m,r]=o.useState(""),[l,c]=o.useState(!1),x=s=>{s.preventDefault(),i.trim()&&m.trim()&&t({name:i.trim(),id:m.trim(),shareData:l})};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(T,{className:"w-full max-w-md bg-white/95 backdrop-blur-sm shadow-xl",children:[e.jsxs(L,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-2",children:[e.jsx(ie,{className:"w-8 h-8 text-purple-600"}),e.jsx(z,{className:"text-2xl text-slate-900",children:"Visual Search Task"})]}),e.jsx("p",{className:"text-slate-600",children:"Search for targets among distractors"})]}),e.jsx(k,{children:e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"name",children:"Your Name"}),e.jsx(K,{id:"name",type:"text",value:i,onChange:s=>n(s.target.value),placeholder:"Enter your full name",required:!0})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"id",children:"Student ID"}),e.jsx(K,{id:"id",type:"text",value:m,onChange:s=>r(s.target.value),placeholder:"Enter your student ID",required:!0})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{id:"shareData",type:"checkbox",checked:l,onChange:s=>c(s.target.checked),className:"mt-1 w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500"}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"shareData",className:"font-medium text-blue-900 cursor-pointer",children:"Share my data with the class"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Your data will be included in class results for analysis. You can always download your individual results regardless of this setting."})]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Task Instructions"]}),e.jsxs("ul",{className:"text-sm text-slate-700 space-y-2",children:[e.jsx("li",{children:"• Look for target shapes among distractor shapes"}),e.jsxs("li",{children:["• Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-white rounded text-xs font-mono",children:"J"})," if you see the target"]}),e.jsxs("li",{children:["• Press ",e.jsx("kbd",{className:"px-1 py-0.5 bg-white rounded text-xs font-mono",children:"K"})," if no target is present"]}),e.jsx("li",{children:"• Respond as quickly and accurately as possible"}),e.jsx("li",{children:"• You'll start with practice trials, then the main task"})]})]}),e.jsx(_,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700 text-white",disabled:!i.trim()||!m.trim(),children:"Start Practice Trials"})]})})]})})}function he({stimulus:t,showStimulus:i,interTrialDelay:n,isPractice:m,colors:r}){if(n)return e.jsx("div",{className:"text-center min-h-[400px] flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"})});if(!i||!t)return e.jsx("div",{className:"text-center min-h-[400px] flex items-center justify-center",children:e.jsx("div",{className:"text-4xl text-slate-400 font-bold",children:"+"})});const l=Math.ceil(Math.sqrt(t.setSize*1.5)),c=[],x=new Set;for(let s=0;s<t.stimuli.length;s++){let a;do a=Math.floor(Math.random()*(l*l));while(x.has(a));x.add(a),c.push(a)}return e.jsxs("div",{className:"text-center min-h-[400px] flex flex-col items-center justify-center",children:[e.jsx("div",{className:"grid gap-3 mb-8",style:{gridTemplateColumns:`repeat(${l}, 1fr)`,width:`${l*50}px`,height:`${l*50}px`},children:Array.from({length:l*l},(s,a)=>{const p=c.indexOf(a);if(!(p!==-1))return e.jsx("div",{className:"w-10 h-10"},a);const h=t.stimuli[p],d=r[h.color],b=h.orientation==="vertical";return e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("div",{className:"transition-all duration-200",style:{backgroundColor:d,width:b?"4px":"24px",height:b?"24px":"4px",borderRadius:"2px"}})},a)})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-slate-200 max-w-sm",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs font-mono",children:"J"}),e.jsx("span",{className:"text-emerald-600 font-medium",children:"Target Present"})]}),e.jsx("div",{className:"w-px h-4 bg-slate-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs font-mono",children:"K"}),e.jsx("span",{className:"text-red-600 font-medium",children:"Target Absent"})]})]})}),m&&e.jsx("div",{className:"mt-4 bg-purple-50 rounded-lg p-3 max-w-md",children:e.jsxs("p",{className:"text-xs text-purple-700",children:[e.jsx("strong",{children:"Practice:"})," Look for blue vertical lines (|) or orange horizontal lines (—)"]})})]})}function pe({results:t,onComplete:i}){const[n,m]=o.useState(!1),r=t.length>0?t.filter(s=>s.is_correct).length/t.length*100:0,l=t.filter(s=>s.is_correct&&s.participant_response!=="timeout").reduce((s,a,p,g)=>s+a.reaction_time/g.length,0),c=t.reduce((s,a)=>(s[a.condition]||(s[a.condition]={correct:0,total:0,rts:[]}),s[a.condition].total++,a.is_correct&&(s[a.condition].correct++,a.participant_response!=="timeout"&&s[a.condition].rts.push(a.reaction_time)),s),{}),x=()=>{m(!0);try{const a=[["student_name","student_id","trial_number","condition","set_size","target_present","correct_response","participant_response","reaction_time","is_correct","session_start_time","timestamp"].join(","),...t.map(d=>[`"${d.student_name}"`,`"${d.student_id}"`,d.trial_number,d.condition,d.set_size,d.target_present,d.correct_response,d.participant_response,d.reaction_time,d.is_correct,d.session_start_time,d.timestamp].join(","))].join(`
`),p=new Blob([a],{type:"text/csv"}),g=URL.createObjectURL(p),h=document.createElement("a");h.href=g,h.download=`visual_search_results_${Date.now()}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g)}catch(s){console.error("Error downloading results:",s)}m(!1)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(T,{className:"w-full max-w-2xl bg-white/95 backdrop-blur-sm shadow-xl",children:[e.jsxs(L,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(G,{className:"w-12 h-12 text-emerald-500"}),e.jsx(z,{className:"text-3xl text-slate-900",children:"Task Complete!"})]}),e.jsx("p",{className:"text-slate-600",children:"Excellent work! Here's a summary of your visual search performance."})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4 text-center border border-emerald-200",children:[e.jsx(W,{className:"w-6 h-6 text-emerald-600 mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-emerald-800",children:[r.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-emerald-600",children:"Overall Accuracy"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center border border-purple-200",children:[e.jsx(Z,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),e.jsxs("div",{className:"text-3xl font-bold text-purple-800",children:[l.toFixed(0),"ms"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Average RT"})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Performance by Search Type"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:Object.entries(c).map(([s,a])=>{const p=a.total>0?a.correct/a.total*100:0,g=a.rts.length>0?a.rts.reduce((h,d)=>h+d,0)/a.rts.length:0;return e.jsxs("div",{className:"bg-white rounded p-3 border border-slate-200",children:[e.jsx("div",{className:"font-medium text-slate-800 capitalize mb-1",children:s.replace("_"," ")}),e.jsxs("div",{className:"text-slate-600",children:[p.toFixed(1),"% correct, ",g.toFixed(0),"ms avg"]})]},s)})})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"What's Next?"]}),e.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"Your data will help analyze visual attention mechanisms. You can download your individual results for personal analysis, and if you opted to share, your data contributes to class research on search slopes and attention theory."}),e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx("strong",{children:"Research Focus:"})," Compare reaction time slopes between pop-out vs. conjunction search conditions."]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(_,{onClick:x,disabled:n,variant:"outline",className:"flex-1",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),n?"Downloading...":"Download My Results"]}),e.jsx(_,{onClick:i,className:"flex-1 bg-purple-600 hover:bg-purple-700 text-white",children:"Return to Home"})]})]})]})})}function ge({results:t,onContinue:i}){const n=t.length>0?t.filter(r=>r.is_correct).length/t.length*100:0,m=t.filter(r=>r.is_correct&&r.participant_response!=="timeout").reduce((r,l,c,x)=>r+l.reaction_time/x.length,0);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 flex items-center justify-center p-4",children:e.jsxs(T,{className:"w-full max-w-lg bg-white/95 backdrop-blur-sm shadow-xl",children:[e.jsxs(L,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(G,{className:"w-10 h-10 text-emerald-500"}),e.jsx(z,{className:"text-2xl text-slate-900",children:"Practice Complete!"})]}),e.jsx("p",{className:"text-slate-600",children:"Great job! Here's how you performed in the practice trials."})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4 text-center border border-emerald-200",children:[e.jsx(W,{className:"w-6 h-6 text-emerald-600 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-800",children:[n.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-emerald-600",children:"Accuracy"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center border border-purple-200",children:[e.jsx(Z,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold text-purple-800",children:[m.toFixed(0),"ms"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Avg Response Time"})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-2",children:"Ready for the main task?"}),e.jsxs("ul",{className:"text-sm text-slate-700 space-y-1",children:[e.jsxs("li",{children:["• The main task will have ",n>=80?"the same types of":"similar"," search arrays"]}),e.jsx("li",{children:"• Try to maintain both speed and accuracy"}),e.jsx("li",{children:"• Some searches will be easier (pop-out) than others (conjunction)"}),e.jsx("li",{children:"• Take your time if needed - there's no rush"})]})]}),n<70&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Tip:"})," Your accuracy was a bit low. Remember to look carefully for the target before responding. Don't worry - the main task will give you more practice!"]})}),e.jsx(_,{onClick:i,className:"w-full bg-purple-600 hover:bg-purple-700 text-white",children:"Continue to Main Task"})]})]})})}const M=80,O=12,$=5e3,fe={blue:"#0066CC",orange:"#FF6600"},B=[{type:"color_popout",target:{color:"blue",orientation:"vertical"},distractors:[{color:"orange",orientation:"vertical"}]},{type:"orientation_popout",target:{color:"blue",orientation:"vertical"},distractors:[{color:"blue",orientation:"horizontal"}]},{type:"conjunction",target:{color:"blue",orientation:"vertical"},distractors:[{color:"blue",orientation:"horizontal"},{color:"orange",orientation:"vertical"}]},{type:"conjunction",target:{color:"orange",orientation:"horizontal"},distractors:[{color:"orange",orientation:"vertical"},{color:"blue",orientation:"horizontal"}]}],H=[4,8,16,24],je=(t,i,n,m)=>{const r=t.target,l=t.distractors;let c=[];if(n){c.push({type:"target",color:r.color,orientation:r.orientation});for(let x=1;x<i;x++){const s=l[Math.floor(Math.random()*l.length)];c.push({type:"distractor",color:s.color,orientation:s.orientation})}}else for(let x=0;x<i;x++){const s=l[Math.floor(Math.random()*l.length)];c.push({type:"distractor",color:s.color,orientation:s.orientation})}return c=c.sort(()=>Math.random()-.5),{condition:t.type,setSize:i,targetPresent:n,stimuli:c,trialNumber:m,correctResponse:n?"j":"k"}},V=t=>{const i=[],n=Math.floor(t/B.length);return B.forEach(m=>{for(let r=0;r<n;r++){const l=H[Math.floor(Math.random()*H.length)],c=Math.random()<.5;i.push(je(m,l,c,i.length+1))}}),i.sort(()=>Math.random()-.5)};function _e(){const[t,i]=o.useState("setup"),[n,m]=o.useState({name:"",id:"",shareData:!1}),[r,l]=o.useState(0),[c,x]=o.useState(null),[s,a]=o.useState(null),[p,g]=o.useState(null),[h,d]=o.useState([]),[b,q]=o.useState([]),[N,Q]=o.useState([]),[v,X]=o.useState([]),[S,F]=o.useState(!1),[C,A]=o.useState(!1),ee=ne();o.useEffect(()=>{t==="practice"?(X(V(O)),l(0)):t==="task"&&(Q(V(M)),l(0))},[t]);const R=o.useCallback(f=>{if(t!=="practice"&&t!=="task"||!S||C)return;const u=f.key.toLowerCase();if(!["j","k"].includes(u))return;const j=Date.now()-s,w=(t==="practice"?v:N)[r],re=u===w.correctResponse,J={student_name:n.name,student_id:n.id,trial_number:r+1,condition:w.condition,set_size:w.setSize,target_present:w.targetPresent,correct_response:w.correctResponse,participant_response:u,reaction_time:j,is_correct:re,session_start_time:c,timestamp:new Date().toISOString(),task_type:"visual_search",share_data:n.shareData};t==="practice"?d(I=>[...I,J]):q(I=>[...I,J]),U()},[t,S,C,r,s,v,N,n,c]);o.useEffect(()=>(document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)),[R]);const U=()=>{F(!1),A(!0),setTimeout(()=>{const f=t==="practice"?O:M;r+1>=f?i(t==="practice"?"practice_complete":"complete"):(l(u=>u+1),A(!1),D())},500)},D=()=>{const u=(t==="practice"?v:N)[r];g(u),setTimeout(()=>{a(Date.now()),F(!0),setTimeout(()=>{if(S){const y={student_name:n.name,student_id:n.id,trial_number:r+1,condition:u.condition,set_size:u.setSize,target_present:u.targetPresent,correct_response:u.correctResponse,participant_response:"timeout",reaction_time:$,is_correct:!1,session_start_time:c,timestamp:new Date().toISOString(),task_type:"visual_search",share_data:n.shareData};t==="practice"?d(j=>[...j,y]):q(j=>[...j,y]),U()}},$)},500)},te=f=>{m(f),x(new Date().toISOString()),i("practice")},se=()=>{i("task")},ae=async()=>{try{const u=[...JSON.parse(localStorage.getItem("visualSearchResults")||"[]"),...b];if(localStorage.setItem("visualSearchResults",JSON.stringify(u)),n.shareData)for(const y of b)try{await fetch("/api/record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})}catch(j){console.warn("Failed to save result to API:",j)}}catch(f){console.error("Error saving results:",f)}ee("/")};o.useEffect(()=>{(t==="practice"&&r===0&&v.length>0||t==="task"&&r===0&&N.length>0)&&D()},[t,v,N]);const P=t==="practice"?O:M,Y=P>0?(r+1)/P*100:0;return t==="setup"?e.jsx(ue,{onComplete:te}):t==="practice_complete"?e.jsx(ge,{results:h,onContinue:se}):t==="complete"?e.jsx(pe,{results:b,onComplete:ae}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 flex items-center justify-center p-4",children:e.jsx(T,{className:"w-full max-w-4xl bg-white/95 backdrop-blur-sm shadow-xl",children:e.jsxs(k,{className:"p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(xe,{className:"w-6 h-6 text-purple-600"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Visual Search Task"})]}),e.jsx("p",{className:"text-slate-600",children:t==="practice"?"Practice Trials":"Main Task"}),e.jsxs("div",{className:"mt-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-600 mb-2",children:[e.jsxs("span",{children:["Trial ",r+1," of ",P]}),e.jsxs("span",{children:[Math.round(Y),"%"]})]}),e.jsx(le,{value:Y,className:"h-2"})]})]}),e.jsx(he,{stimulus:p,showStimulus:S,interTrialDelay:C,isPractice:t==="practice",colors:fe}),e.jsx("div",{className:"text-center mt-8",children:e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("p",{className:"text-sm text-slate-700 mb-3",children:["Press ",e.jsx("kbd",{className:"px-2 py-1 bg-white rounded shadow text-xs font-mono",children:"J"})," if target present,",e.jsx("kbd",{className:"px-2 py-1 bg-white rounded shadow text-xs font-mono ml-2",children:"K"})," if target absent"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Target: ",t==="practice"?"Blue vertical line":"Look for blue vertical or orange horizontal lines"]})]})})]})})})}export{_e as default};
