import{j as e}from"./index-c78af160.js";import{r as p,u as O}from"./react-vendor-36975316.js";import{C as L,a as A}from"./button-b2bad4e5.js";import{u as D,T as V,V as z,P as F,g as J,b as U,h as $,d as K}from"./PracticeComplete-024c88c1.js";import{U as G}from"./ui-vendor-7ca303c8.js";class H{static async create(t,c=!1){try{const o=JSON.parse(localStorage.getItem("visualSearchResults")||"[]"),d={...t,id:Date.now(),timestamp:new Date().toISOString()};if(o.push(d),localStorage.setItem("visualSearchResults",JSON.stringify(o)),c){const n=await fetch("/api/record",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return n.ok?(console.log("Visual Search data shared with class successfully"),{success:!0,data:t,shared:!0}):(console.info(`API response: ${n.status} - This is expected in development mode`),{success:!0,data:t,shared:!1})}else return console.log("Visual Search data kept private (not shared with class)"),{success:!0,data:t,shared:!1}}catch(o){return console.info("API not available in development mode:",o.message),{success:!1,error:o.message,data:t}}}static getLocal(){return JSON.parse(localStorage.getItem("visualSearchResults")||"[]")}static clearLocal(){return localStorage.removeItem("visualSearchResults"),{success:!0,message:"Local Visual Search results cleared"}}}function q({stimulus:r,showStimulus:t,showingFixation:c,interTrialDelay:o,isPractice:d,colors:n}){if(o)return e.jsx("div",{className:"text-center min-h-[400px] flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-slate-400 rounded-full"})});if(c||!t&&!r)return e.jsx("div",{className:"text-center min-h-[400px] flex items-center justify-center",children:e.jsx("div",{className:"text-4xl text-slate-400 font-bold",children:"+"})});if(!t||!r)return e.jsx("div",{className:"text-center min-h-[400px] flex items-center justify-center",children:e.jsx("div",{className:"text-4xl text-slate-400 font-bold",children:"+"})});const s=Math.ceil(Math.sqrt(r.setSize*1.5)),u=[],m=new Set;for(let h=0;h<r.stimuli.length;h++){let i;do i=Math.floor(Math.random()*(s*s));while(m.has(i));m.add(i),u.push(i)}return e.jsxs("div",{className:"text-center min-h-[400px] flex flex-col items-center justify-center",children:[e.jsx("div",{className:"grid gap-3 mb-8",style:{gridTemplateColumns:`repeat(${s}, 1fr)`,width:`${s*50}px`,height:`${s*50}px`},children:Array.from({length:s*s},(h,i)=>{const f=u.indexOf(i);if(!(f!==-1))return e.jsx("div",{className:"w-10 h-10"},i);const x=r.stimuli[f],S=n[x.color],g=x.orientation==="vertical";return e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx("div",{className:"transition-all duration-200",style:{backgroundColor:S,width:g?"4px":"24px",height:g?"24px":"4px",borderRadius:"2px"}})},i)})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-slate-200 max-w-sm",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs font-mono",children:"J"}),e.jsx("span",{className:"text-emerald-600 font-medium",children:"Target Present"})]}),e.jsx("div",{className:"w-px h-4 bg-slate-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("kbd",{className:"px-2 py-1 bg-slate-100 rounded text-xs font-mono",children:"K"}),e.jsx("span",{className:"text-red-600 font-medium",children:"Target Absent"})]})]})}),d&&e.jsx("div",{className:"mt-4 bg-purple-50 rounded-lg p-3 max-w-md",children:e.jsxs("p",{className:"text-xs text-purple-700",children:[e.jsx("strong",{children:"Practice:"})," Look for blue vertical lines (|) or orange horizontal lines (â€”)"]})})]})}const B=80,Z=12,Q=5e3,W={blue:"#0066CC",orange:"#FF6600"},w=[{type:"color_popout",target:{color:"blue",orientation:"vertical"},distractors:[{color:"orange",orientation:"vertical"}]},{type:"orientation_popout",target:{color:"blue",orientation:"vertical"},distractors:[{color:"blue",orientation:"horizontal"}]},{type:"conjunction",target:{color:"blue",orientation:"vertical"},distractors:[{color:"blue",orientation:"horizontal"},{color:"orange",orientation:"vertical"}]},{type:"conjunction",target:{color:"orange",orientation:"horizontal"},distractors:[{color:"orange",orientation:"vertical"},{color:"blue",orientation:"horizontal"}]}],C=[4,8,16,24],X=(r,t,c,o)=>{const d=r.target,n=r.distractors;let s=[];if(c){s.push({type:"target",color:d.color,orientation:d.orientation});for(let u=1;u<t;u++){const m=n[Math.floor(Math.random()*n.length)];s.push({type:"distractor",color:m.color,orientation:m.orientation})}}else for(let u=0;u<t;u++){const m=n[Math.floor(Math.random()*n.length)];s.push({type:"distractor",color:m.color,orientation:m.orientation})}return s=s.sort(()=>Math.random()-.5),{condition:r.type,setSize:t,targetPresent:c,stimuli:s,trialNumber:o,correctResponse:c?"j":"k"}},Y=r=>{const t=[],c=Math.floor(r/w.length);return w.forEach(o=>{for(let d=0;d<c;d++){const n=C[Math.floor(Math.random()*C.length)],s=Math.random()<.5;t.push(X(o,n,s,t.length+1))}}),t.sort(()=>Math.random()-.5)};function ne(){const[r,t]=p.useState({name:"",id:"",shareData:!1}),[c,o]=p.useState(null),[d,n]=p.useState(null);O();const s=p.useCallback(a=>Y(a),[]),u=s(Z),m=s(B),{phase:h,currentTrial:i,showStimulus:f,showingFixation:N,awaitingResponse:x,inInterTrialDelay:S,results:g,practiceResults:I,startPractice:_,startMainTask:k,handleResponse:b,getCurrentTrial:ee,totalTrials:v}=D({practiceTrials:u,mainTrials:m,responseTimeout:Q,interTrialDelay:{practice:800,task:500},fixationDelay:500,showFixation:!0,onTrialStart:(a,l,j)=>{o(a)},onTrialEnd:(a,l,j,y)=>{const M=a.response===l.correctResponse,T={...a,student_name:r.name,student_id:r.id,condition:l.condition,set_size:l.setSize,target_present:l.targetPresent,correct_response:l.correctResponse,participant_response:a.response,is_correct:M,session_start_time:d,task_type:"visual_search",share_data:r.shareData};if(y==="task")try{H.create(T,r.shareData)}catch(P){console.error("Error saving result:",P)}return T},onPhaseComplete:(a,l)=>{console.log(`${a} phase completed with ${l.length} trials`)},onExperimentComplete:(a,l)=>{console.log("Visual Search experiment completed!",{mainResults:a,practiceResults:l})}});p.useEffect(()=>{const a=l=>{if(!x)return;const j=l.key.toLowerCase();["j","k"].includes(j)&&b(j,Date.now())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[x,b]);const R=a=>{t(a),n(new Date().toISOString()),_()},E=()=>{k()};return h==="setup"?e.jsx(V,{onComplete:R,config:z}):h==="practice_complete"?e.jsx(F,{results:I,onContinue:E,config:J}):h==="complete"?e.jsx(U,{results:g,studentInfo:r,config:$}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-purple-50 flex items-center justify-center p-4",children:e.jsx(L,{className:"w-full max-w-4xl bg-white/95 backdrop-blur-sm shadow-xl",children:e.jsxs(A,{className:"p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(G,{className:"w-6 h-6 text-purple-600"}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Visual Search Task"})]}),e.jsx("p",{className:"text-slate-600",children:h==="practice"?"Practice Trials":"Main Task"}),e.jsxs("div",{className:"mt-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-600 mb-2",children:[e.jsxs("span",{children:["Trial ",i+1," of ",v]}),e.jsxs("span",{children:[Math.round((i+1)/v*100),"%"]})]}),e.jsx(K,{value:(i+1)/v*100,className:"h-2"})]})]}),e.jsx(q,{stimulus:c,showStimulus:f,showingFixation:N,interTrialDelay:S,isPractice:h==="practice",colors:W}),e.jsx("div",{className:"text-center mt-8",children:e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("p",{className:"text-sm text-slate-700 mb-3",children:["Press ",e.jsx("kbd",{className:"px-2 py-1 bg-white rounded shadow text-xs font-mono",children:"J"})," if target present,",e.jsx("kbd",{className:"px-2 py-1 bg-white rounded shadow text-xs font-mono ml-2",children:"K"})," if target absent"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Target: ",h==="practice"?"Blue vertical line":"Look for blue vertical or orange horizontal lines"]})]})})]})})})}export{ne as default};
