import{j as e}from"./index-29ae61cf.js";import{c as b,r as k}from"./react-vendor-36975316.js";import{F as J}from"./FlankerResult-51025eab.js";import{C as L,c as S,b as A,a as F,B as N}from"./button-24bec710.js";import{a as W}from"./utils-a3ea4c3f.js";import{g as U,T as Y,h as q,e as G,D as $,f as O,A as V}from"./ui-vendor-b175fcb0.js";import{f as K}from"./date-vendor-66ee9ebe.js";function Q({results:t,participants:a}){const n=a.length;t.length;const v=t.length>0?t.filter(l=>l.is_correct).length/t.length*100:0,f=t.filter(l=>l.is_correct&&l.participant_response!=="timeout").reduce((l,s,d,i)=>l+s.reaction_time/i.length,0),g=a.map(l=>{const s=l.trials.filter(m=>m.stimulus_type==="congruent"&&m.is_correct),d=l.trials.filter(m=>m.stimulus_type==="incongruent"&&m.is_correct),i=s.reduce((m,u)=>m+u.reaction_time,0)/s.length;return d.reduce((m,u)=>m+u.reaction_time,0)/d.length-i}).filter(l=>!isNaN(l)),w=g.length>0?g.reduce((l,s)=>l+s,0)/g.length:0,C=[{title:"Total Participants",value:n,icon:U,color:"text-blue-600",bgColor:"bg-blue-50"},{title:"Overall Accuracy",value:`${v.toFixed(1)}%`,icon:Y,color:"text-emerald-600",bgColor:"bg-emerald-50"},{title:"Average RT",value:`${f.toFixed(0)}ms`,icon:q,color:"text-orange-600",bgColor:"bg-orange-50"},{title:"Flanker Effect",value:`+${w.toFixed(0)}ms`,icon:G,color:"text-purple-600",bgColor:"bg-purple-50"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map((l,s)=>e.jsxs(L,{className:"bg-white/80 backdrop-blur-sm border-slate-200/60 shadow-xl",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:"text-sm font-medium text-slate-600",children:l.title}),e.jsx("div",{className:`p-2 rounded-lg ${l.bgColor}`,children:e.jsx(l.icon,{className:`w-4 h-4 ${l.color}`})})]})}),e.jsx(F,{className:"pt-0",children:e.jsx("div",{className:`text-2xl font-bold ${l.color}`,children:l.value})})]},s))})}const P=b.forwardRef(({className:t="",...a},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:`w-full caption-bottom text-sm ${t}`,...a})}));P.displayName="Table";const B=b.forwardRef(({className:t="",...a},n)=>e.jsx("thead",{ref:n,className:`[&_tr]:border-b ${t}`,...a}));B.displayName="TableHeader";const H=b.forwardRef(({className:t="",...a},n)=>e.jsx("tbody",{ref:n,className:`[&_tr:last-child]:border-0 ${t}`,...a}));H.displayName="TableBody";const X=b.forwardRef(({className:t="",...a},n)=>e.jsx("tfoot",{ref:n,className:`border-t bg-slate-100/50 font-medium [&>tr]:last:border-b-0 ${t}`,...a}));X.displayName="TableFooter";const E=b.forwardRef(({className:t="",...a},n)=>e.jsx("tr",{ref:n,className:`border-b transition-colors hover:bg-slate-100/50 data-[state=selected]:bg-slate-100 ${t}`,...a}));E.displayName="TableRow";const _=b.forwardRef(({className:t="",...a},n)=>e.jsx("th",{ref:n,className:`h-12 px-4 text-left align-middle font-medium text-slate-500 [&:has([role=checkbox])]:pr-0 ${t}`,...a}));_.displayName="TableHead";const y=b.forwardRef(({className:t="",...a},n)=>e.jsx("td",{ref:n,className:`p-4 align-middle [&:has([role=checkbox])]:pr-0 ${t}`,...a}));y.displayName="TableCell";const Z=b.forwardRef(({className:t="",...a},n)=>e.jsx("caption",{ref:n,className:`mt-4 text-sm text-slate-500 ${t}`,...a}));Z.displayName="TableCaption";const T=b.forwardRef(({className:t="",variant:a="default",...n},v)=>{const f={default:"bg-slate-900 text-slate-50 hover:bg-slate-900/80",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-100/80",destructive:"bg-red-600 text-slate-50 hover:bg-red-600/80",outline:"border border-slate-200 text-slate-950",success:"bg-green-600 text-slate-50 hover:bg-green-600/80"};return e.jsx("div",{ref:v,className:`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 ${f[a]} ${t}`,...n})});T.displayName="Badge";function ee({participants:t}){const[a,n]=k.useState(!1),[v,f]=k.useState(!1),g=s=>{const i=[["trial_number","stimulus_type","stimulus_display","correct_response","participant_response","reaction_time_ms","is_correct"].join(","),...s.trials.map(r=>[r.trial_number,r.stimulus_type,`"${r.stimulus_display}"`,r.correct_response,r.participant_response,r.reaction_time,r.is_correct].join(","))].join(`
`),x=new Blob([i],{type:"text/csv"}),m=URL.createObjectURL(x),u=document.createElement("a");u.href=m,u.download=`flanker_${s.name.replace(/\s+/g,"_")}_results.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(m)},w=async()=>{try{const s=await fetch("/api/record",{method:"GET"});if(s.ok){const d=await s.blob(),i=URL.createObjectURL(d),x=document.createElement("a");x.href=i,x.download="cogsci_class_results.csv",document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(i)}else console.error("Failed to download class data:",s.statusText),alert("Failed to download class data. Please try again.")}catch(s){console.error("Error downloading class data:",s),alert("Error downloading class data. Please check your connection.")}},C=async()=>{n(!0);try{const s=await fetch("/api/record",{method:"DELETE"});if(s.ok){const d=await s.json();alert(`Successfully cleared ${d.recordsCleared} records. The page will now reload.`),window.location.reload()}else console.error("Failed to clear data:",s.statusText),alert("Failed to clear data. Please try again.")}catch(s){console.error("Error clearing data:",s),alert("Error clearing data. Please check your connection.")}finally{n(!1),f(!1)}},l=s=>{const d=s.filter(o=>o.is_correct),i=d.length/s.length*100,x=d.filter(o=>o.participant_response!=="timeout"),m=x.length>0?x.reduce((o,c)=>o+c.reaction_time,0)/x.length:0,u=s.filter(o=>o.stimulus_type==="congruent"&&o.is_correct),r=s.filter(o=>o.stimulus_type==="incongruent"&&o.is_correct),h=u.length>0?u.reduce((o,c)=>o+c.reaction_time,0)/u.length:0,R=(r.length>0?r.reduce((o,c)=>o+c.reaction_time,0)/r.length:0)-h;return{accuracy:i,avgRT:m,flankerEffect:R}};return e.jsxs(L,{className:"bg-white border-slate-200",children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(A,{className:"text-xl",children:"Participant Results"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",onClick:w,className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Download Class Data"]}),v?e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(V,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-700 font-medium",children:"Clear all data?"}),e.jsx(N,{size:"sm",variant:"destructive",onClick:C,disabled:a,children:a?"Clearing...":"Yes, Clear All"}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>f(!1),disabled:a,children:"Cancel"})]}):e.jsxs(N,{variant:"outline",onClick:()=>f(!0),className:"flex items-center gap-2 text-red-600 hover:text-red-700 hover:border-red-300",children:[e.jsx(O,{className:"w-4 h-4"}),"Reset Data"]})]})]}),t.length>0&&e.jsxs("p",{className:"text-sm text-slate-600",children:["📊 ",t.length," student",t.length!==1?"s":""," completed • Ready for R analysis"]})]}),e.jsx(F,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(P,{children:[e.jsx(B,{children:e.jsxs(E,{children:[e.jsx(_,{children:"Participant"}),e.jsx(_,{children:"Student ID"}),e.jsx(_,{children:"Completed"}),e.jsx(_,{children:"Accuracy"}),e.jsx(_,{children:"Avg RT"}),e.jsx(_,{children:"Flanker Effect"}),e.jsx(_,{children:"Actions"})]})}),e.jsx(H,{children:t.map((s,d)=>{const i=l(s.trials);return e.jsxs(E,{children:[e.jsx(y,{className:"font-medium",children:s.name}),e.jsx(y,{children:s.id}),e.jsx(y,{children:e.jsx(T,{variant:"outline",className:"bg-blue-50 text-blue-700",children:K(new Date(s.completedAt),"MM/dd HH:mm")})}),e.jsx(y,{children:e.jsxs(T,{variant:i.accuracy>=75?"default":"destructive",children:[i.accuracy.toFixed(1),"%"]})}),e.jsxs(y,{children:[i.avgRT.toFixed(0),"ms"]}),e.jsx(y,{children:e.jsxs(T,{variant:"outline",className:"bg-purple-50 text-purple-700",children:["+",i.flankerEffect.toFixed(0),"ms"]})}),e.jsx(y,{children:e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>g(s),children:e.jsx($,{className:"w-4 h-4"})})})]},d)})})]})})})]})}function ce(){const[t,a]=k.useState([]),[n,v]=k.useState(!0),[f,g]=k.useState(!1);k.useEffect(()=>{w()},[]);const w=async()=>{try{const r=await J.list("-created_date"),h=JSON.parse(localStorage.getItem("flankerResults")||"[]"),j=JSON.parse(localStorage.getItem("stroopResults")||"[]"),R=h.map(p=>({...p,task_type:p.task_type||"flanker"})),o=j.map(p=>({...p,task_type:p.task_type||"stroop"})),I=[...r,...R,...o].filter((p,M,z)=>M===z.findIndex(D=>D.timestamp===p.timestamp&&D.student_id===p.student_id&&D.trial_number===p.trial_number));a(I)}catch(r){console.error("Error loading results:",r)}v(!1)},C=async()=>{if(confirm("Are you sure you want to clear ALL data? This cannot be undone.")){g(!0);try{await W(),await w()}catch(r){console.error("Error clearing data:",r)}finally{g(!1)}}},l=[...new Set(t.map(r=>r.task_type).filter(Boolean))],s=l.length>1,d=l.length===1?l[0]:null,i=()=>t.length===0?"Results Dashboard":s?"Mixed task performance analysis":d==="flanker"?"Flanker task performance analysis":d==="stroop"?"Stroop task performance analysis":"Cognitive task performance analysis",x=()=>{if(t.length===0)return;const h=[["task_type","student_name","student_id","trial_number","stimulus_type","stimulus_display","correct_response","participant_response","reaction_time_ms","is_correct","session_start_time","date_completed"].join(","),...t.map(c=>[`"${c.task_type||"flanker"}"`,`"${c.student_name}"`,`"${c.student_id}"`,c.trial_number,c.stimulus_type,`"${c.stimulus_display}"`,c.correct_response,c.participant_response,c.reaction_time||c.reaction_time_ms,c.is_correct,c.session_start_time,c.created_date||c.timestamp].join(","))].join(`
`),j=new Blob([h],{type:"text/csv"}),R=URL.createObjectURL(j),o=document.createElement("a");o.href=R,o.download=`cognitive_tasks_results_${Date.now()}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(R)},m=t.reduce((r,h)=>{const j=`${h.student_name}_${h.student_id}`;return r[j]||(r[j]={name:h.student_name,id:h.student_id,sessionStart:h.session_start_time,trials:[]}),r[j].trials.push(h),r},{}),u=Object.values(m);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Results Dashboard"}),e.jsx("p",{className:"text-slate-600 mt-1",children:i()})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{onClick:C,disabled:t.length===0||f,variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),f?"Clearing...":"Clear All Data"]}),e.jsxs(N,{onClick:x,disabled:t.length===0,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Export All Data"]})]})]}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-slate-600 mt-4",children:"Loading results..."})]}):t.length===0?e.jsx(L,{className:"bg-white border-slate-200 max-w-2xl mx-auto",children:e.jsxs(F,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(U,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No Data Yet"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Students haven't started taking experiments yet. Once they begin, results will appear here in real-time."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"📝 For Instructors:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Have students visit the homepage and start an experiment"}),e.jsx("li",{children:"• Results will automatically aggregate here"}),e.jsx("li",{children:"• Download CSV data for R analysis when ready"}),e.jsx("li",{children:'• Use "Reset Data" before each new class session'})]})]})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(Q,{results:t,participants:u}),e.jsx(ee,{participants:u})]})]})})}export{ce as default};
